<view class="datecalc-page" data-theme="{{theme}}">
  <view class="custom-nav">
    <button class="back-btn" bindtap="goBack">â†</button>
    <!-- <text class="nav-title">æ—¥æœŸè®¡ç®—</text> -->
    <button class="home-btn" bindtap="goHome">ğŸ </button>
  </view>

  <view class="mode-selector">
    <view class="mode-buttons">
      <button 
        class="mode-btn {{mode === 'diff' ? 'active' : ''}}" 
        bindtap="setMode" 
        data-mode="diff"
      >
        æ—¥æœŸå·®
      </button>
      <button 
        class="mode-btn {{mode === 'add' ? 'active' : ''}}" 
        bindtap="setMode" 
        data-mode="add"
      >
        æ—¥æœŸåŠ å‡
      </button>
      <button 
        class="mode-btn {{mode === 'workday' ? 'active' : ''}}" 
        bindtap="setMode" 
        data-mode="workday"
      >
        å·¥ä½œæ—¥
      </button>
    </view>
  </view>

  <!-- æ—¥æœŸå·®è®¡ç®— -->
  <view wx:if="{{mode === 'diff'}}" class="calculator-card card">
    <view class="input-group">
      <text class="label">å¼€å§‹æ—¥æœŸ</text>
      <picker mode="date" value="{{startDate}}" bindchange="onStartDateChange">
        <view class="date-picker">{{startDate}}</view>
      </picker>
    </view>
    <view class="input-group">
      <text class="label">ç»“æŸæ—¥æœŸ</text>
      <picker mode="date" value="{{endDate}}" bindchange="onEndDateChange">
        <view class="date-picker">{{endDate}}</view>
      </picker>
    </view>
    <button class="btn-primary" bindtap="calculateDiff">è®¡ç®—</button>
    <view class="result" wx:if="{{diffResult}}">
      <view class="result-item">
        <text class="result-label">é—´éš”å¤©æ•°:</text>
        <text class="result-value">{{diffResult.days}} å¤©</text>
      </view>
      <view class="result-item">
        <text class="result-label">é—´éš”å‘¨æ•°:</text>
        <text class="result-value">{{diffResult.weeks}} å‘¨ {{diffResult.extraDays}} å¤©</text>
      </view>
      <view class="result-item">
        <text class="result-label">é—´éš”æœˆæ•°:</text>
        <text class="result-value">{{diffResult.months}} ä¸ªæœˆ</text>
      </view>
      <view class="result-item">
        <text class="result-label">é—´éš”å¹´æ•°:</text>
        <text class="result-value">{{diffResult.years}} å¹´</text>
      </view>
    </view>
  </view>

  <!-- æ—¥æœŸåŠ å‡ -->
  <view wx:if="{{mode === 'add'}}" class="calculator-card card">
    <view class="input-group">
      <text class="label">åŸºå‡†æ—¥æœŸ</text>
      <picker mode="date" value="{{baseDate}}" bindchange="onBaseDateChange">
        <view class="date-picker">{{baseDate}}</view>
      </picker>
    </view>
    <view class="input-row">
      <input 
        class="number-input" 
        type="number" 
        placeholder="å¤©æ•°" 
        value="{{addDays}}" 
        bindinput="onAddDaysChange"
      />
      <button class="btn-secondary" bindtap="addDaysCalc" data-days="7">+7å¤©</button>
      <button class="btn-secondary" bindtap="addDaysCalc" data-days="30">+30å¤©</button>
    </view>
    <view class="input-row">
      <input 
        class="number-input" 
        type="number" 
        placeholder="æœˆæ•°" 
        value="{{addMonths}}" 
        bindinput="onAddMonthsChange"
      />
      <input 
        class="number-input" 
        type="number" 
        placeholder="å¹´æ•°" 
        value="{{addYears}}" 
        bindinput="onAddYearsChange"
      />
    </view>
    <button class="btn-primary" bindtap="calculateAdd">è®¡ç®—</button>
    <view class="result" wx:if="{{addResult}}">
      <view class="result-item">
        <text class="result-label">è®¡ç®—ç»“æœ:</text>
        <text class="result-value">{{addResult}}</text>
      </view>
    </view>
  </view>

  <!-- å·¥ä½œæ—¥è®¡ç®— -->
  <view wx:if="{{mode === 'workday'}}" class="calculator-card card">
    <view class="input-group">
      <text class="label">å¼€å§‹æ—¥æœŸ</text>
      <picker mode="date" value="{{workStartDate}}" bindchange="onWorkStartDateChange">
        <view class="date-picker">{{workStartDate}}</view>
      </picker>
    </view>
    <view class="input-group">
      <text class="label">ç»“æŸæ—¥æœŸ</text>
      <picker mode="date" value="{{workEndDate}}" bindchange="onWorkEndDateChange">
        <view class="date-picker">{{workEndDate}}</view>
      </picker>
    </view>
    <button class="btn-primary" bindtap="calculateWorkdays">è®¡ç®—å·¥ä½œæ—¥</button>
    <view class="result" wx:if="{{workdayResult}}">
      <view class="result-item">
        <text class="result-label">å·¥ä½œæ—¥æ€»æ•°:</text>
        <text class="result-value">{{workdayResult.totalDays}} å¤©</text>
      </view>
      <view class="result-item">
        <text class="result-label">å‘¨æœ«å¤©æ•°:</text>
        <text class="result-value">{{workdayResult.weekendDays}} å¤©</text>
      </view>
      <view class="result-item">
        <text class="result-label">å·¥ä½œæ—¥:</text>
        <text class="result-value">{{workdayResult.workdays}} å¤©</text>
      </view>
    </view>
  </view>

  <!-- å†å²è®°å½• -->
  <view class="history-card card" wx:if="{{history.length > 0}}">
    <view class="history-header">
      <text>è®¡ç®—å†å²</text>
      <button class="clear-btn" bindtap="clearHistory">æ¸…ç©º</button>
    </view>
    <view class="history-list">
      <view class="history-item" wx:for="{{history}}" wx:key="index">
        <text class="history-content">{{item.data.expression}}</text>
        <text class="history-result">{{item.data.result}}</text>
        <text class="history-time">{{item.time}}</text>
      </view>
    </view>
  </view>
</view>