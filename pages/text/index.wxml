<view class="text-page" data-theme="{{theme}}">
  <!-- é¡¶éƒ¨å¯¼èˆª -->
  <view class="custom-nav">
    <button class="back-btn" bindtap="goBack">â†</button>
    <!-- <text class="nav-title">æ–‡æœ¬å¤„ç†</text> -->
    <button class="home-btn" bindtap="goHome">ğŸ </button>
  </view>

  <!-- å¤„ç†ç±»å‹é€‰æ‹© -->
  <view class="type-section">
    <view class="type-dropdown">
      <picker 
        class="type-picker" 
        range="{{formatTypes}}" 
        range-key="name" 
        value="{{formatTypeIndex}}" 
        bindchange="changeFormatType"
      >
        <view class="picker-display">
          <text class="picker-text">{{formatTypes[formatTypeIndex].name}}</text>
          <text class="picker-arrow">â–¼</text>
        </view>
      </picker>
    </view>
  </view>

  <!-- è¾“å…¥åŒºåŸŸ -->
  <view class="input-section">
    <view class="input-card card">
      <!-- è¾“å…¥æ–‡æœ¬åŒºåŸŸ -->
      <view class="input-group">
        <view class="input-label">
          <text>è¾“å…¥æ–‡æœ¬</text>
          <text class="input-counter">{{inputText.length}} å­—ç¬¦</text>
        </view>
        <textarea 
          class="text-input" 
          placeholder="è¯·è¾“å…¥è¦å¤„ç†çš„æ–‡æœ¬..." 
          value="{{inputText}}"
          bindinput="onInputChange"
          auto-height
          maxlength="{{maxLength}}"
        />
      </view>

      <!-- æ“ä½œæŒ‰é’® -->
      <view class="action-buttons">
        <button class="action-btn paste-btn" bindtap="pasteFromClipboard">
          ç²˜è´´
        </button>
        <button class="action-btn clear-btn" bindtap="clearInput">
          æ¸…ç©º
        </button>
        <button class="action-btn sample-btn" bindtap="loadSample">
          ç¤ºä¾‹
        </button>
      </view>

      <!-- æ ¼å¼åŒ–é€‰é¡¹ -->
      <view class="format-options" wx:if="{{currentFormatType.value === 'json'}}">
        <view class="options-group">
          <checkbox-group bindchange="toggleOption">
            <label class="option-item">
              <checkbox value="indent" checked="{{indentSpaces > 0}}" /> ç¼©è¿›
            </label>
            <label class="option-item" wx:if="{{indentSpaces > 0}}">
              <picker 
                class="indent-picker" 
                range="{{indentOptions}}" 
                value="{{indentIndex}}"
                bindchange="changeIndent"
              >
                <view class="picker-display">{{indentOptions[indentIndex]}} ç©ºæ ¼</view>
              </picker>
            </label>
            <label class="option-item">
              <checkbox value="sort" checked="{{sortKeys}}" /> æŒ‰é”®æ’åº
            </label>
          </checkbox-group>
        </view>
      </view>

      <!-- é¢„è§ˆé€‰é¡¹ -->
      <view class="preview-options" wx:if="{{currentFormatType.value === 'markdown' || currentFormatType.value === 'html'}}">
        <view class="preview-buttons">
          <button 
            class="preview-btn {{viewMode === 'source' ? 'active' : ''}}" 
            data-mode="source"
            bindtap="changeViewMode"
          >
            æºä»£ç 
          </button>
          <button 
            class="preview-btn {{viewMode === 'preview' ? 'active' : ''}}" 
            data-mode="preview"
            bindtap="changeViewMode"
          >
            é¢„è§ˆ
          </button>
        </view>
      </view>

      <!-- å¤„ç†æŒ‰é’® -->
      <button 
        class="process-btn" 
        bindtap="processText"
        disabled="{{!inputText || isProcessing}}"
      >
        {{isProcessing ? 'å¤„ç†ä¸­...' : 'å¼€å§‹å¤„ç†'}}
      </button>
    </view>
  </view>

  <!-- å¤„ç†ç»“æœ -->
  <view class="result-section" wx:if="{{resultText}}">
    <view class="result-card card">
      <view class="result-header">
        <text class="result-title">{{viewMode === 'preview' && (currentFormatType.value === 'markdown' || currentFormatType.value === 'html') ? 'é¢„è§ˆç»“æœ' : 'å¤„ç†ç»“æœ'}}</text>
        <view class="result-actions">
          <button class="copy-btn" bindtap="copyResult">å¤åˆ¶</button>
          <button class="clear-btn" bindtap="clearResult">æ¸…ç©º</button>
        </view>
      </view>

      <!-- ç»“æœæ˜¾ç¤º -->
      <view class="result-group">
        <view class="result-label">
          <text>{{viewMode === 'preview' ? 'é¢„è§ˆ' : 'ç»“æœ'}}</text>
          <text class="result-counter">{{resultText.length}} å­—ç¬¦</text>
        </view>
        
        <!-- æºä»£ç è§†å›¾ -->
        <scroll-view 
          class="result-container" 
          scroll-y 
          wx:if="{{viewMode === 'source' || currentFormatType.value === 'json' || currentFormatType.value === 'xml' || currentFormatType.value === 'yaml'}}"
        >
          <view class="result-content {{currentFormatType.value}}">
            <text class="result-text">{{resultText}}</text>
          </view>
        </scroll-view>
        
        <!-- é¢„è§ˆè§†å›¾ -->
        <scroll-view 
          class="preview-container" 
          scroll-y 
          wx:if="{{viewMode === 'preview' && (currentFormatType.value === 'markdown' || currentFormatType.value === 'html')}}"
        >
          <view class="preview-content {{currentFormatType.value}}">
            <rich-text nodes="{{previewNodes}}"></rich-text>
          </view>
        </scroll-view>
      </view>

      <!-- å¤„ç†ä¿¡æ¯ -->
      <view class="info-group" wx:if="{{processInfo}}">
        <view class="info-label">
          <text>å¤„ç†ä¿¡æ¯</text>
        </view>
        <view class="info-content">
          <text class="info-text">{{processInfo}}</text>
        </view>
      </view>
    </view>
  </view>

  <!-- æ ¼å¼è¯´æ˜ -->
  <view class="help-section">
    <view class="help-card card">
      <view class="help-header">
        <text class="help-title">{{helpTitle}}</text>
      </view>
      <view class="help-content">
        <view class="help-item" wx:for="{{helpItems}}" wx:key="index">
          <text class="help-dot">â€¢</text>
          <text class="help-text">{{item}}</text>
        </view>
      </view>
    </view>
  </view>

  <!-- å†å²è®°å½• -->
  <view class="history-section" wx:if="{{history.length > 0}}">
    <view class="history-card card">
      <view class="history-header">
        <text class="history-title">å¤„ç†å†å²</text>
        <button class="clear-btn" bindtap="clearHistory">æ¸…ç©º</button>
      </view>
      <scroll-view class="history-list" scroll-y>
        <view 
          class="history-item" 
          wx:for="{{history}}" 
          wx:key="index"
          data-index="{{index}}"
          bindtap="loadHistoryItem"
        >
          <view class="history-type">
            <text class="type-label">{{item.data.type}}æ ¼å¼åŒ–</text>
            <text class="history-time">{{item.time}}</text>
          </view>
          <view class="history-preview">
            <text class="preview-text">{{item.data.preview}}</text>
          </view>
        </view>
      </scroll-view>
    </view>
  </view>
</view>