<view class="currency-page" data-theme="{{theme}}">
  <!-- é¡¶éƒ¨å¯¼èˆª -->
  <view class="custom-nav">
    <button class="back-btn" bindtap="goBack">â†</button>
    <!-- <text class="nav-title">è´§å¸æ¢ç®—</text> -->
    <button class="home-btn" bindtap="goHome">ğŸ </button>
  </view>

  <!-- æ±‡ç‡æ›´æ–°æ—¶é—´ -->
  <view class="update-time" wx:if="{{lastUpdate}}">
    <text>æ±‡ç‡æ›´æ–°æ—¶é—´: {{lastUpdate}}</text>
  </view>

  <!-- ä¸»æ¢ç®—åŒºåŸŸ -->
  <view class="main-section">
    <view class="converter-card card">
      <!-- è¾“å…¥åŒºåŸŸ -->
      <view class="input-section">
        <view class="input-header">
          <text class="input-label">è¾“å…¥é‡‘é¢</text>
        </view>
        <view class="amount-group">
          <input 
            class="amount-input" 
            type="number" 
            placeholder="0.00" 
            value="{{fromAmount}}" 
            bindinput="onFromAmountChange"
          />
          <view class="currency-select-group">
            <picker 
              class="currency-picker" 
              range="{{currencyList}}" 
              range-key="nameWithSymbol" 
              value="{{fromCurrencyIndex}}" 
              bindchange="onFromCurrencyChange"
            >
              <view class="picker-display">
                <text class="currency-symbol">{{currencyList[fromCurrencyIndex].symbol}}</text>
                <text class="currency-code">{{currencyList[fromCurrencyIndex].code}}</text>
              </view>
            </picker>
          </view>
        </view>
      </view>

      <!-- è½¬æ¢æŒ‰é’® -->
      <view class="conversion-control">
        <button class="swap-btn" bindtap="swapCurrencies">
          <text class="swap-icon">â‡„ äº¤æ¢</text>
        </button>
      </view>

      <!-- è¾“å‡ºåŒºåŸŸ -->
      <view class="input-section">
        <view class="input-header">
          <text class="input-label">æ¢ç®—ç»“æœ</text>
        </view>
        <view class="amount-group">
          <input 
            class="amount-input" 
            type="text" 
            placeholder="0.00" 
            value="{{toAmount}}" 
            disabled
          />
          <view class="currency-select-group">
            <picker 
              class="currency-picker" 
              range="{{currencyList}}" 
              range-key="nameWithSymbol" 
              value="{{toCurrencyIndex}}" 
              bindchange="onToCurrencyChange"
            >
              <view class="picker-display">
                <text class="currency-symbol">{{currencyList[toCurrencyIndex].symbol}}</text>
                <text class="currency-code">{{currencyList[toCurrencyIndex].code}}</text>
              </view>
            </picker>
          </view>
        </view>
      </view>

      <!-- æ±‡ç‡æ˜¾ç¤º -->
      <view class="rate-display" wx:if="{{exchangeRate}}">
        <text class="rate-text">æ±‡ç‡: 1 {{currencyList[fromCurrencyIndex].code}} = {{exchangeRate}} {{currencyList[toCurrencyIndex].code}}</text>
      </view>

      <!-- è®¡ç®—æŒ‰é’® -->
      <button 
        class="calc-btn" 
        bindtap="startConvert" 
        disabled="{{!fromAmount || isConverting}}"
      >
        {{isConverting ? 'è®¡ç®—ä¸­...' : 'ç«‹å³æ¢ç®—'}}
      </button>
    </view>

    <!-- å¸¸ç”¨è´§å¸ -->
    <view class="common-currencies">
      <view class="section-header">
        <text class="section-title">å¸¸ç”¨è´§å¸</text>
      </view>
      <scroll-view class="currency-scroll" scroll-x>
        <view class="currency-scroll-content">
          <view 
            class="currency-item" 
            wx:for="{{quickCurrencies}}" 
            wx:key="code"
            data-code="{{item.code}}"
            data-type="{{item.type}}"
            bindtap="quickSelectCurrency"
          >
            <text class="currency-symbol-small">{{item.symbol}}</text>
            <text class="currency-code-small">{{item.code}}</text>
          </view>
        </view>
      </scroll-view>
    </view>

    <!-- æ±‡ç‡è¡¨æ ¼ -->
    <view class="rates-table-section" wx:if="{{exchangeRates.length > 0}}">
      <view class="section-header">
        <text class="section-title">ä¸»è¦è´§å¸æ±‡ç‡ (ä»¥{{currencyList[fromCurrencyIndex].code}}ä¸ºåŸºå‡†)</text>
      </view>
      <view class="rates-table">
        <view class="table-header">
          <text class="header-cell">è´§å¸</text>
          <text class="header-cell">æ±‡ç‡</text>
          <text class="header-cell">æ›´æ–°æ—¶é—´</text>
        </view>
        <scroll-view class="table-body" scroll-y>
          <view class="table-row" wx:for="{{exchangeRates}}" wx:key="code">
            <view class="table-cell currency-cell">
              <text class="cell-symbol">{{item.symbol}}</text>
              <text class="cell-code">{{item.code}}</text>
            </view>
            <text class="table-cell rate-cell">{{item.rate.toFixed(4)}}</text>
            <text class="table-cell time-cell">{{item.timestamp}}</text>
          </view>
        </scroll-view>
      </view>
    </view>
  </view>

  <!-- å†å²è®°å½• -->
  <view class="history-section" wx:if="{{history.length > 0}}">
    <view class="section-header">
      <text class="section-title">å†å²è®°å½•</text>
      <button class="clear-history-btn" bindtap="clearHistory">æ¸…ç©º</button>
    </view>
    <view class="history-list">
      <view class="history-item" wx:for="{{history}}" wx:key="index">
        <view class="history-content">
          <text class="history-amount">{{item.data.fromAmount}}</text>
          <text class="history-currency">{{item.data.fromCurrency}}</text>
          <text class="history-equals">=</text>
          <text class="history-amount">{{item.data.toAmount}}</text>
          <text class="history-currency">{{item.data.toCurrency}}</text>
        </view>
        <view class="history-info">
          <text class="history-rate">æ±‡ç‡: {{item.data.rate}}</text>
          <text class="history-time">{{item.time}}</text>
        </view>
      </view>
    </view>
  </view>

  <!-- è¯´æ˜ä¿¡æ¯ -->
  <view class="info-section">
    <view class="info-header">
      <text class="info-title">ä½¿ç”¨è¯´æ˜</text>
    </view>
    <view class="info-content">
      <text class="info-text">â€¢ æ”¯æŒå…¨çƒ150+ç§è´§å¸å®æ—¶æ¢ç®—</text>
      <text class="info-text">â€¢ æ±‡ç‡æ•°æ®æ¯30åˆ†é’Ÿè‡ªåŠ¨æ›´æ–°</text>
      <text class="info-text">â€¢ æ”¯æŒç¦»çº¿ä½¿ç”¨ï¼ˆä½¿ç”¨ç¼“å­˜æ±‡ç‡ï¼‰</text>
      <text class="info-text">â€¢ æ‰€æœ‰æ•°æ®ä»…ä¿å­˜åœ¨æœ¬åœ°</text>
    </view>
  </view>
</view>